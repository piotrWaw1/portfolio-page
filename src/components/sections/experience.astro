---
import { AnimateIn } from "@/components/ui/animate-in";
import ExternalLink from "@lucide/astro/icons/external-link";
import { getEntry } from "astro:content";

const tagColors = [
  "bg-primary/10 text-primary border-primary/20",
  "bg-accent/10 text-accent border-accent/20",
  "bg-cyan/10 text-cyan border-cyan/20",
  "bg-amber/10 text-amber border-amber/20",
  "bg-rose/10 text-rose border-rose/20",
];

const JOB_STYLES = [
  { accent: "group-hover:text-primary", border: "hover:border-l-primary" },
  { accent: "group-hover:text-accent", border: "hover:border-l-accent" },
  { accent: "group-hover:text-cyan", border: "hover:border-l-cyan" },
  { accent: "group-hover:text-amber", border: "hover:border-l-amber" },
  { accent: "group-hover:text-rose", border: "hover:border-l-rose" },
];

const experienceEntry = await getEntry("experience", "experience");
const data = experienceEntry?.data;
---

<section id="experience" class="mesh-bg-warm px-6 py-24 md:py-32">
  <div class="mx-auto max-w-6xl">
    <AnimateIn client:visible>
      <div class="mb-12 flex items-center gap-4">
        <h2
          class="text-foreground flex items-center gap-2 text-2xl font-bold md:text-3xl"
        >
          <span class="text-accent font-mono text-lg md:text-xl"> 02. </span>
          {data?.title}
        </h2>
        <div class="from-accent/40 h-px flex-1 bg-gradient-to-r to-transparent">
        </div>
      </div>
    </AnimateIn>

    <div class="flex flex-col gap-6">
      {
        data?.jobs.map((exp, index) => (
          <AnimateIn delay={index * 100} client:visible>
            <a
              href={exp.url}
              class={`group hover:bg-secondary/50 grid gap-4 rounded-xl border-l-2 border-l-transparent p-5 transition-all md:grid-cols-4 md:p-6 ${JOB_STYLES[index].border}`}
            >
              <div class="text-muted-foreground font-mono text-xs tracking-wider uppercase md:pt-1">
                {exp.period}
              </div>
              <div class="md:col-span-3">
                <h3
                  class={`text-foreground flex items-center gap-2 text-base font-medium ${JOB_STYLES[index].accent}`}
                >
                  {exp.title} &middot; {exp.company}
                  <ExternalLink class="h-3.5 w-3.5 opacity-0 transition-all group-hover:translate-x-0.5 group-hover:-translate-y-0.5 group-hover:opacity-100" />
                </h3>
                <p class="text-muted-foreground mt-2 text-sm leading-relaxed">
                  {exp.description}
                </p>
                <div class="mt-4 flex flex-wrap gap-2">
                  {exp.tags.map((tag, tagIndex) => (
                    <span
                      class={`rounded-full border px-3 py-1 font-mono text-xs ${tagColors[tagIndex % tagColors.length]}`}
                    >
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </a>
          </AnimateIn>
        ))
      }
    </div>
  </div>
</section>
